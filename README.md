# Machine Learning-Based Cyberdefenses Competition

- [Quick start](#quick-start)
- [Build the sample solution](#build-the-sample-solution)
- [Requirements](#requirements)
- [Dataset](#dataset)

## <a name='quick-start'></a>Quick start

Instead of building solution from code, download the docker image from [here](https://1drv.ms/u/s!Ambkzg779D1mg6x7WrapF7TEsGUFQQ?e=5N9zWU).

Before you proceed, you must [install Docker Engine](https://docs.docker.com/engine/install/) for your operating system.

Load the docker image 
```bash
docker load -i ml.rar
```

Run the docker container:
```bash
docker run -itp 8080:8080 --memory=1g ml
```

Test the solution on malicious and benign samples of your choosing via:
```bash
python -m test -m data/DikeDataset-main/files/malware -b data/DikeDataset-main/files/benign
```

## <a name='build-the-sample-solution'></a>Build the sample solution
Before you proceed, you must [install Docker Engine](https://docs.docker.com/engine/install/) for your operating system.

A sample solution that you may modify is included in the `defender` folder. 

Install Python requirements needed to test the solution:
```bash
pip install -r requirements.txt
```

OPTIONAL: To apply obfuscation to the code, copy the `defender` folder somewhere else since it is applied in place and run
```bash
pyminify defender/ --in-place --remove-literal-statements
```

Compile python code to run faster and slightly obfuscate code run
```bash
python out.py
```

Some trained models can be found in `defender/saved_models`. 

Add the `*.pkl` file to use as model into `docker/models/`, we will later set the model to use during docker run.

From the `root` folder that contains the `Dockerfile`, build the solution:
```bash
docker build -t ml .
```

Run the docker container:
```bash
docker run -itp 8080:8080 --memory=1g ml
```
The flag `-p 8080:8080` maps the container's port 8080 to the host's port 8080.

The flag `--memory=1g` limits the container with 1GB of RAM.

The flag `--env MODEL_FILE="models/ml_classifier.pkl"` can be added to specify which model to run

Test the solution on malicious and benign samples of your choosing via:
```bash
python -m test -m data/DikeDataset-main/files/malware -b data/DikeDataset-main/files/benign
```
You can also use the system folder `C:\Windows\System32\` as benign samples.

Sample collections may be in a folder, or in an archive of type `zip`, `tar`, `tar.bz2`, `tar.gz` or `tgz`.  

**It is not required to unzip and strongly recommended that you do not unzip the archive to test malicious samples.** 


## <a name='requirements'></a>Requirements

Minimum scores
- FPR 1%
- TPR 95%

Constraints
- 1GB of RAM
- Response time 5 seconds per sample

A valid submission for the defense track consists of the following
1. a Docker image
2. listens on port 8080
3. accepts `POST /` with header `Content-Type: application/octet-stream` and the contents of a PE file in the body
4. returns `{"result": 0}` for benign files and `{"result": 1}` for malicious files 
5. for files up to 10**21 bytes (10 MiB), must respond in less than 5 seconds (a timeout results in a benign verdict)

## Dataset

TODO

A 80/20 train/test split was used.
To generate a train/test split, apply the feature extractor, and save them for training models
```bash
python -m defender.utils
```
